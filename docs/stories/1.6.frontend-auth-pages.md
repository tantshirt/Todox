# Story 1.6: Frontend Login & Registration Pages

## Status
Ready

## Story

**As a** user,  
**I want** accessible login and registration pages,  
**so that** I can authenticate and access the application through the UI.

## Acceptance Criteria

1. Login page created at `/auth/login` with form containing email and password fields
2. Registration page created at `/auth/register` with form containing email and password fields
3. Forms use Shadcn UI components with proper accessibility (labels, focus states, ARIA attributes)
4. Client-side validation using Zod ensures: valid email format, password minimum length before submission
5. Form submissions call respective backend API endpoints (`POST /auth/register`, `POST /auth/login`)
6. Successful login stores JWT token securely (httpOnly cookie or secure localStorage with documented rationale)
7. Successful registration redirects to login page with success message
8. Successful login redirects to dashboard/task list page
9. API errors display as toast notifications or inline error messages with clear, actionable text
10. Loading states show during API calls (disabled buttons, spinners)
11. Basic styling applied using Tailwind CSS and Shadcn components for professional appearance

## Tasks / Subtasks

- [ ] Task 1: Install required Shadcn UI components (AC: 3, 11)
  - [ ] Run `npx shadcn-ui@latest add button input label card form toast` in frontend directory
  - [ ] Components will be added to `frontend/src/components/ui/`
  - [ ] Verify components include accessibility features (ARIA labels, keyboard navigation)

- [ ] Task 2: Create Zod validation schemas (AC: 4)
  - [ ] Create `frontend/src/lib/validations.ts`
  - [ ] Import `zod`
  - [ ] Define `loginSchema = z.object({ email: z.string().email("Invalid email format"), password: z.string().min(8, "Password must be at least 8 characters") })`
  - [ ] Define `registerSchema = z.object({ email: z.string().email("Invalid email format"), password: z.string().min(8, "Password must be at least 8 characters") })`
  - [ ] Export both schemas

- [ ] Task 3: Create API client for auth (AC: 5)
  - [ ] Create `frontend/src/lib/api.ts`
  - [ ] Define `API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000'`
  - [ ] Implement `register(email, password)` function: POST to /auth/register
  - [ ] Implement `login(email, password)` function: POST to /auth/login
  - [ ] Both functions should handle errors and return typed responses
  - [ ] Use fetch API with proper headers (Content-Type: application/json)

- [ ] Task 4: Create TypeScript types for auth (AC: 5, 6)
  - [ ] Create `frontend/src/types/auth.ts`
  - [ ] Define `LoginRequest`, `RegisterRequest`, `AuthResponse`, `User` interfaces matching backend schemas
  - [ ] Export all types

- [ ] Task 5: Create Registration page (AC: 2, 4, 7, 9, 10, 11)
  - [ ] Create `frontend/src/app/auth/register/page.tsx`
  - [ ] Import Shadcn components: Card, Input, Label, Button
  - [ ] Create form with email and password fields
  - [ ] Use Zod for client-side validation
  - [ ] On submit: call API client register(), show loading state, handle success/error
  - [ ] On success: show toast "Registration successful", redirect to /auth/login using `useRouter`
  - [ ] On error: display error message via toast or inline
  - [ ] Include link to login page: "Already have an account? Log in"
  - [ ] Apply Tailwind CSS for styling

- [ ] Task 6: Create Login page (AC: 1, 4, 6, 8, 9, 10, 11)
  - [ ] Create `frontend/src/app/auth/login/page.tsx`
  - [ ] Import Shadcn components: Card, Input, Label, Button
  - [ ] Create form with email and password fields
  - [ ] Use Zod for client-side validation
  - [ ] On submit: call API client login(), show loading state
  - [ ] On success: store access_token in localStorage (document rationale: "Using localStorage for MVP simplicity. Production should use httpOnly cookies."), redirect to /tasks
  - [ ] On error: display error message via toast or inline
  - [ ] Include link to register page: "Don't have an account? Sign up"
  - [ ] Apply Tailwind CSS for styling

- [ ] Task 7: Configure toast notifications (AC: 9)
  - [ ] Install sonner toast library: `npm install sonner` in frontend
  - [ ] Update `frontend/src/app/layout.tsx` to include `<Toaster />` component from sonner
  - [ ] Import and use toast functions in auth pages: `toast.success()`, `toast.error()`

- [ ] Task 8: Test auth pages manually (AC: All)
  - [ ] Start backend: `uvicorn src.main:app --reload` from backend/
  - [ ] Start frontend: `npm run dev` from frontend/
  - [ ] Test registration flow: fill form, submit, verify redirect to login
  - [ ] Test login flow: fill form, submit, verify redirect to /tasks and token in localStorage
  - [ ] Test validation: try invalid email, short password, verify error messages
  - [ ] Test API errors: try registering duplicate email, verify 409 error displays

## Dev Notes

### Frontend Pages Structure

**[Source: docs/architecture/frontend-architecture.md#Component Organization]**

Next.js App Router uses file-based routing. Auth pages go in:
- `frontend/src/app/auth/login/page.tsx` - Login page at /auth/login
- `frontend/src/app/auth/register/page.tsx` - Registration page at /auth/register

### Form Design Specifications

**[Source: docs/front-end-spec.md#Login Screen, Registration Screen]**

**Login Screen Layout:**
- App logo/branding at top
- Centered card/form containing:
  - Email input field (type="email", required)
  - Password input field (type="password", required)
  - "Log In" primary button
  - Error message area (conditionally shown)
- Link to registration: "Don't have an account? Sign up"
- Loading spinner on button during submission

**Registration Screen Layout:**
- App logo/branding at top
- Centered card/form containing:
  - Email input field (type="email", required)
  - Password input field (type="password", required, minlength="8")
  - Password requirements hint: "At least 8 characters"
  - "Create Account" primary button
  - Validation error messages (inline below fields)
- Link to login: "Already have an account? Log in"
- Loading spinner on button during submission

### Shadcn UI Components

**[Source: docs/front-end-spec.md#Component Library]**

**Components to use:**
- **Card:** Container for form (provides elevation and padding)
- **Input:** Text inputs for email and password
- **Label:** Accessible labels for form fields
- **Button:** Primary action button with loading state
- **Form:** Form wrapper with validation (from Shadcn)

**Component Usage:**
```typescript
import { Card, CardHeader, CardTitle, CardContent } from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Button } from "@/components/ui/button";
```

### Zod Validation

**[Source: docs/architecture/coding-standards.md#Validation]**

Use Zod for all data validation on frontend. Never trust client input or skip validation.

**Validation Schema Example:**
```typescript
import { z } from "zod";

export const loginSchema = z.object({
  email: z.string().email("Please enter a valid email address"),
  password: z.string().min(8, "Password must be at least 8 characters"),
});

export type LoginFormData = z.infer<typeof loginSchema>;
```

### Token Storage Decision

**[Source: PRD NFR6, Security Discussion]**

**For MVP:** Use localStorage for simplicity
- Easier to implement
- Works across all browsers
- Suitable for demonstration/learning project

**Document in code comment:**
```typescript
// Storing JWT in localStorage for MVP simplicity.
// Production consideration: Use httpOnly cookies to prevent XSS attacks.
// Trade-off: localStorage is vulnerable to XSS but easier to implement.
localStorage.setItem('access_token', response.access_token);
```

**Alternative (Production):** httpOnly cookies require backend to set cookie in response, more secure against XSS.

### API Client Implementation

**[Source: docs/architecture/frontend-architecture.md#API Client Setup]**

Create a simple API client:

```typescript
const API_BASE_URL = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000';

export async function register(email: string, password: string) {
  const response = await fetch(`${API_BASE_URL}/auth/register`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ email, password }),
  });

  if (!response.ok) {
    const error = await response.json();
    throw new Error(error.detail || 'Registration failed');
  }

  return response.json();
}

export async function login(email: string, password: string) {
  const response = await fetch(`${API_BASE_URL}/auth/login`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ email, password }),
  });

  if (!response.ok) {
    const error = await response.json();
    throw new Error(error.detail || 'Login failed');
  }

  return response.json();
}
```

### User Flow Reference

**[Source: docs/front-end-spec.md#User Flow 1: User Registration & First Login]**

The complete user flow with edge cases and error handling is documented. Key points:
- Registration redirects to login on success
- Login redirects to /tasks on success
- Error messages display via toast notifications
- Forms include loading states during API calls
- Client-side validation prevents invalid submissions

### Accessibility Requirements

**[Source: docs/front-end-spec.md#Accessibility Requirements]**

**WCAG AA Compliance:**
- All inputs have associated `<label>` elements (not just placeholders)
- Form can be submitted with Enter key
- Error messages linked to inputs via aria-describedby
- Focus visible on all interactive elements
- Color contrast ratios meet 4.5:1 minimum

### File Locations

**[Source: docs/architecture/frontend-architecture.md]**

Create these files:
- `frontend/src/app/auth/login/page.tsx` - Login page component
- `frontend/src/app/auth/register/page.tsx` - Registration page component
- `frontend/src/lib/api.ts` - API client functions
- `frontend/src/lib/validations.ts` - Zod validation schemas
- `frontend/src/types/auth.ts` - TypeScript type definitions

### Testing

**[Source: docs/architecture/testing-strategy.md]**

**For This Story:**
- Manual testing via browser (automated E2E tests in Story 1.8)
- Test checklist:
  - ✓ Forms render correctly
  - ✓ Client-side validation works
  - ✓ API calls succeed/fail appropriately
  - ✓ Error messages display clearly
  - ✓ Loading states appear during submission
  - ✓ Token stored after successful login
  - ✓ Redirects work correctly

**Accessibility Testing:**
- Tab through form with keyboard only
- Verify all fields are accessible
- Check color contrast with browser DevTools

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-12 | 1.0 | Story created from Epic 1 | Bob (SM) |

## Dev Agent Record

### Agent Model Used
_To be populated by dev agent_

### Debug Log References
_To be populated by dev agent_

### Completion Notes List
_To be populated by dev agent_

### File List
_To be populated by dev agent_

## QA Results
_To be populated by QA agent after implementation_
