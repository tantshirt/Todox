# Story 2.4: Update Task API

## Status
Ready

## Story

**As a** user,  
**I want** to update a task's properties,  
**so that** I can modify title, description, status, priority, or deadline as my needs change.

## Acceptance Criteria

1. API endpoint `PATCH /tasks/:id` accepts JSON body with any subset of: title, description, priority, deadline, status
2. Endpoint requires authentication and verifies task belongs to authenticated user (return 404 if not found or unauthorized)
3. Only provided fields are updated; omitted fields remain unchanged
4. updated_at timestamp is set to current time on update
5. Successful update returns 200 status with complete updated Task object
6. Validation errors return 400 with clear messages for invalid field values
7. Unit tests cover: partial updates, field validation, ownership verification, non-existent task handling

## Tasks / Subtasks

- [ ] Task 1: Implement update_task in service (AC: 2, 3, 4)
  - [ ] Update `backend/src/services/task_service.py`
  - [ ] Implement `async def update_task(self, task_id: str, owner_id: str, task_data: TaskUpdate) -> Optional[TaskResponse]`
  - [ ] Convert task_data to dict (exclude None values)
  - [ ] Call task_repository.update_task(ObjectId(task_id), ObjectId(owner_id), update_dict)
  - [ ] Return TaskResponse or None if not found

- [ ] Task 2: Create PATCH /tasks/:id route (AC: 1, 2, 5, 6)
  - [ ] Update `backend/src/api/v1/tasks.py`
  - [ ] Implement `PATCH /tasks/{task_id}` with authentication
  - [ ] Validate task_id is valid ObjectId format
  - [ ] Call task_service.update_task()
  - [ ] If None returned, raise HTTPException(404, "Task not found")
  - [ ] Return 200 with updated TaskResponse

- [ ] Task 3: Write tests (AC: 7)
  - [ ] Update `backend/tests/test_tasks.py`
  - [ ] Test partial update: update only title
  - [ ] Test full update: update all fields
  - [ ] Test ownership: user cannot update other user's task (404)
  - [ ] Test non-existent task: 404
  - [ ] Test invalid field values: validation errors
  - [ ] Test updated_at: verify timestamp changes

## Dev Notes

**[Source: docs/architecture/api-specification.md#PATCH /tasks/{id}]**

Partial update endpoint. Only fields provided in request body are updated.

**CRITICAL Security:** Ownership verification prevents unauthorized access. Return 404 (not 403) to prevent task enumeration.

**[Source: docs/architecture/backend-architecture.md#Controller Template]**

Repository's update_task includes owner_id in query filter for automatic ownership enforcement.

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-12 | 1.0 | Story created from Epic 2 | Bob (SM) |

## Dev Agent Record

### Agent Model Used
_To be populated by dev agent_

### Debug Log References
_To be populated by dev agent_

### Completion Notes List
_To be populated by dev agent_

### File List
_To be populated by dev agent_

## QA Results
_To be populated by QA agent after implementation_
