# Story 4.4: Task Export/Import

## Status
Ready

## Story

**As a** user,  
**I want** to export my tasks to JSON and import them back,  
**so that** I can backup my data or transfer tasks between accounts.

## Acceptance Criteria

1. "Export Tasks" button downloads all user tasks as JSON file
2. Exported JSON includes all task fields (title, description, priority, deadline, status, labels)
3. "Import Tasks" button allows uploading JSON file
4. Import validates JSON structure before creating tasks
5. Import shows success message with count of tasks imported
6. Import errors show clear message if JSON is invalid
7. Exported filename includes username and timestamp (e.g., `todox-tasks-user@example.com-2025-09-30.json`)

## Tasks / Subtasks

- [ ] Task 1: Implement export functionality (AC: 1, 2, 7)
  - [ ] Update `frontend/src/app/tasks/page.tsx`
  - [ ] Add "Export Tasks" button
  - [ ] Function to convert tasks array to JSON
  - [ ] Generate filename with user email + timestamp
  - [ ] Trigger browser download using Blob and URL.createObjectURL
  - [ ] Export format: `{ version: "1.0", exported_at: ISO string, tasks: Task[] }`

- [ ] Task 2: Implement import functionality (AC: 3, 4, 5, 6)
  - [ ] Add "Import Tasks" button with file input
  - [ ] Read uploaded JSON file
  - [ ] Validate structure (has version, tasks array)
  - [ ] For each task in import: call createTask API
  - [ ] Show loading state during import
  - [ ] Show success toast with count
  - [ ] Handle errors gracefully

- [ ] Task 3: Manual testing
  - [ ] Export tasks to JSON file
  - [ ] Verify JSON structure
  - [ ] Import tasks from exported file
  - [ ] Test with invalid JSON
  - [ ] Test with empty task list

## Dev Notes

### Export Implementation

```typescript
const handleExport = () => {
  const exportData = {
    version: "1.0",
    exported_at: new Date().toISOString(),
    tasks: tasks,
  };
  
  const blob = new Blob([JSON.stringify(exportData, null, 2)], {
    type: 'application/json',
  });
  
  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.href = url;
  link.download = `todox-tasks-${user?.email}-${new Date().toISOString().split('T')[0]}.json`;
  link.click();
  
  URL.revokeObjectURL(url);
  toast.success(`Exported ${tasks.length} tasks`);
};
```

### Import Implementation

```typescript
const handleImport = async (e: React.ChangeEvent<HTMLInputElement>) => {
  const file = e.target.files?.[0];
  if (!file) return;
  
  const text = await file.text();
  const data = JSON.parse(text);
  
  if (!data.tasks || !Array.isArray(data.tasks)) {
    toast.error('Invalid file format');
    return;
  }
  
  let imported = 0;
  for (const task of data.tasks) {
    try {
      await createTask({
        title: task.title,
        description: task.description,
        priority: task.priority,
        deadline: task.deadline,
        label_ids: task.label_ids || [],
      });
      imported++;
    } catch (error) {
      // Continue with next task
    }
  }
  
  toast.success(`Imported ${imported} tasks`);
};
```

### File Locations

Modify:
- `frontend/src/app/tasks/page.tsx`

Optional:
- `frontend/src/lib/task-utils.ts`

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-30 | 1.0 | Story created for Epic 4 | Bob (SM) |

## Dev Agent Record
_To be populated by dev agent_

## QA Results
_To be populated by QA agent_

