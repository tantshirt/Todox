# Story 4.1: Task Filtering by Labels

## Status
Ready

## Story

**As a** user,  
**I want** to filter tasks by one or more labels,  
**so that** I can focus on specific categories of work and find related tasks quickly.

## Acceptance Criteria

1. Label filter UI component appears above task list with all available labels
2. User can select/deselect labels to filter tasks (multi-select supported)
3. Task list updates to show only tasks that have ALL selected labels (AND logic)
4. "Clear Filters" button resets to show all tasks
5. Filter state persists while navigating within the app (React state)
6. Selected filters shown visually (highlighted/checked labels)
7. Empty state shows when no tasks match selected filters with helpful message

## Tasks / Subtasks

- [ ] Task 1: Create LabelFilter component (AC: 1, 2, 6)
  - [ ] Create `frontend/src/components/tasks/LabelFilter.tsx`
  - [ ] Component displays all labels as clickable badges
  - [ ] Track selected label IDs in state
  - [ ] Visual indication for selected labels (different color/checkmark)
  - [ ] Pass selectedLabelIds and onFilterChange as props

- [ ] Task 2: Implement filtering logic in tasks page (AC: 2, 3, 4)
  - [ ] Update `frontend/src/app/tasks/page.tsx`
  - [ ] Add state for selected filter labels
  - [ ] Filter tasks array: `tasks.filter(task => selectedLabels.every(labelId => task.label_ids.includes(labelId)))`
  - [ ] Add "Clear Filters" button that resets selectedLabels to []
  - [ ] Pass filtered tasks to task card rendering

- [ ] Task 3: Handle empty filter results (AC: 7)
  - [ ] Show empty state when filteredTasks.length === 0 but tasks.length > 0
  - [ ] Message: "No tasks match the selected filters" with clear filters button
  - [ ] Distinguish from "No tasks yet" empty state

- [ ] Task 4: Manual testing
  - [ ] Create multiple tasks with different labels
  - [ ] Test filtering by single label
  - [ ] Test filtering by multiple labels (AND logic)
  - [ ] Test clear filters
  - [ ] Test empty results state

## Dev Notes

### Implementation Approach

**Client-Side Filtering** (all data already loaded via React Query)

```typescript
const [selectedLabelFilters, setSelectedLabelFilters] = useState<string[]>([]);

const filteredTasks = selectedLabelFilters.length === 0
  ? tasks
  : tasks.filter(task =>
      selectedLabelFilters.every(labelId => task.label_ids?.includes(labelId))
    );
```

### LabelFilter Component Structure

```typescript
interface LabelFilterProps {
  labels: Label[];
  selectedLabelIds: string[];
  onFilterChange: (labelIds: string[]) => void;
}

export function LabelFilter({ labels, selectedLabelIds, onFilterChange }: LabelFilterProps) {
  const toggleLabel = (labelId: string) => {
    onFilterChange(
      selectedLabelIds.includes(labelId)
        ? selectedLabelIds.filter(id => id !== labelId)
        : [...selectedLabelIds, labelId]
    );
  };
  
  return (
    <div className="flex flex-wrap gap-2">
      {labels.map(label => (
        <Badge
          key={label.id}
          variant={selectedLabelIds.includes(label.id) ? "default" : "outline"}
          className="cursor-pointer"
          onClick={() => toggleLabel(label.id)}
        >
          {selectedLabelIds.includes(label.id) && '✓ '}
          {label.name}
        </Badge>
      ))}
    </div>
  );
}
```

### File Locations

Create:
- `frontend/src/components/tasks/LabelFilter.tsx`

Modify:
- `frontend/src/app/tasks/page.tsx`

### Testing

**Manual Testing Checklist:**
- ✓ Filter by single label shows correct tasks
- ✓ Filter by multiple labels shows tasks with ALL labels (AND logic)
- ✓ Clear filters shows all tasks
- ✓ Empty state when no matches
- ✓ Filter state resets when creating new task

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-30 | 1.0 | Story created for Epic 4 | Bob (SM) |

## Dev Agent Record

### Agent Model Used
_To be populated by dev agent_

### Debug Log References
_To be populated by dev agent_

### Completion Notes List
_To be populated by dev agent_

### File List
_To be populated by dev agent_

## QA Results
_To be populated by QA agent after implementation_

