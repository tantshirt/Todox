# Story 3.2: Label CRUD APIs

## Status
Ready

## Story

**As a** user,  
**I want** to create, view, update, and delete labels,  
**so that** I can manage my custom categories for task organization.

## Acceptance Criteria

1. API endpoint `GET /labels` returns array of Label objects belonging to authenticated user, sorted alphabetically by name
2. API endpoint `POST /labels` accepts JSON body with name (required) and creates new label associated with authenticated user
3. Label creation enforces unique name per user (return 409 Conflict if duplicate)
4. API endpoint `PATCH /labels/:id` allows updating label name (with uniqueness validation)
5. API endpoint `DELETE /labels/:id` removes label and also removes its ID from label_ids array of all tasks
6. All endpoints require authentication and enforce ownership (return 404 for labels not owned by user)
7. Successful operations return appropriate status codes: 200 (get/update), 201 (create), 204 (delete)
8. Unit tests cover: CRUD operations, uniqueness validation, ownership verification, cascade deletion from tasks

## Tasks / Subtasks

- [ ] Task 1: Create Label service (AC: 2, 3, 4, 5)
  - [ ] Create `backend/src/services/label_service.py`
  - [ ] Implement LabelService with create, get_by_owner, update, delete methods
  - [ ] Delete method calls task_repository.remove_label_from_all_tasks() for cascade

- [ ] Task 2: Create Label routes (AC: 1, 2, 4, 5, 6, 7)
  - [ ] Create `backend/src/api/v1/labels.py`
  - [ ] Implement GET /labels, POST /labels, PATCH /labels/:id, DELETE /labels/:id
  - [ ] All routes require authentication
  - [ ] Handle 409 for duplicate names

- [ ] Task 3: Write tests (AC: 8)
  - [ ] Create `backend/tests/test_labels.py`
  - [ ] Test all CRUD operations
  - [ ] Test uniqueness enforcement
  - [ ] Test ownership verification
  - [ ] Test cascade deletion from tasks

## Dev Notes

**[Source: docs/architecture/api-specification.md#/labels]**

Complete CRUD endpoints for labels with authentication required.

**[Source: docs/architecture/backend-architecture.md#Database Architecture]**

Label deletion must cascade: remove label ID from all tasks' label_ids arrays.

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-12 | 1.0 | Story created from Epic 3 | Bob (SM) |

## Dev Agent Record

### Agent Model Used
_To be populated by dev agent_

### Debug Log References
_To be populated by dev agent_

### Completion Notes List
_To be populated by dev agent_

### File List
_To be populated by dev agent_

## QA Results
_To be populated by QA agent after implementation_
