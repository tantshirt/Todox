# Story 3.1: Label Model & Repository

## Status
Ready

## Story

**As a** developer,  
**I want** Label data model and database repository,  
**so that** we can persist and query label data efficiently.

## Acceptance Criteria

1. Label Pydantic model defined with fields: id, name, owner_id (user reference), created_at
2. Label repository class (`db/repositories/labels_repo.py`) implements methods: create_label, find_by_owner, find_by_id, update_label, delete_label
3. MongoDB collection `labels` properly indexes owner_id for efficient queries
4. Label names must be unique per user (validation prevents duplicate names for same owner)
5. Unit tests verify Label model validation and all repository methods using test database

## Tasks / Subtasks

- [ ] Task 1: Define Label Pydantic models (AC: 1)
  - [ ] Create `backend/src/models/label.py`
  - [ ] Define LabelBase with name (str, min_length=1, max_length=50)
  - [ ] Define LabelCreate(LabelBase)
  - [ ] Define LabelUpdate with name (str, min_length=1, max_length=50)
  - [ ] Define LabelInDB with id, owner_id, created_at
  - [ ] Define LabelResponse = LabelInDB

- [ ] Task 2: Implement Label repository (AC: 2, 3, 4)
  - [ ] Create `backend/src/repositories/label_repository.py`
  - [ ] Implement create_label with uniqueness check
  - [ ] Implement find_by_owner (sorted alphabetically by name)
  - [ ] Implement find_by_id with ownership verification
  - [ ] Implement update_label with uniqueness check
  - [ ] Implement delete_label
  - [ ] Implement remove_label_from_tasks helper (cascade delete)
  - [ ] Create compound unique index on (owner_id, name)

- [ ] Task 3: Write unit tests (AC: 5)
  - [ ] Create `backend/tests/test_label_repository.py`
  - [ ] Test create, find, update, delete methods
  - [ ] Test uniqueness per user
  - [ ] Test ownership enforcement

## Dev Notes

**[Source: docs/architecture/data-models.md#Label]**

Label model: id, name (max 50 chars, unique per user), owner_id, created_at

**[Source: docs/architecture/database-schema.md#labels Collection]**

Compound unique index: `(owner_id, name)` prevents duplicate label names per user.

Cascade delete: When label deleted, remove its ID from all tasks' label_ids arrays.

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-12 | 1.0 | Story created from Epic 3 | Bob (SM) |

## Dev Agent Record

### Agent Model Used
_To be populated by dev agent_

### Debug Log References
_To be populated by dev agent_

### Completion Notes List
_To be populated by dev agent_

### File List
_To be populated by dev agent_

## QA Results
_To be populated by QA agent after implementation_
